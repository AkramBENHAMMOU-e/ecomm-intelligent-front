<nav class="topbar" *ngIf="showNavbar">
  <a routerLink="/" class="nav-link">Accueil</a>
  <a routerLink="/dashboard" *ngIf="isAdmin()" class="nav-link">Gestion Produits</a>
  <a routerLink="/orders" *ngIf="isAdmin()" class="nav-link">Gestion Commandes</a>
  <a routerLink="/checkout" class="nav-link">Passer la commande</a>
  
  <!-- Cart Icon with Badge - À droite -->
  <button class="cart-button" (click)="openCartSidebar()" title="Voir le panier">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="9" cy="21" r="1"></circle>
      <circle cx="20" cy="21" r="1"></circle>
      <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
    </svg>
    <span class="cart-badge" *ngIf="cartItemsCount > 0">{{ cartItemsCount }}</span>
  </button>
  
  <button class="logout-btn" (click)="logout()" *ngIf="isAdmin()">Déconnexion</button>
</nav>
<main class="content">
  <router-outlet></router-outlet>
</main>

<!-- Cart Sidebar -->
<div class="overlay" *ngIf="cartSidebarOpen" (click)="closeCartSidebar()"></div>
<aside class="cart-sidebar" *ngIf="cartSidebarOpen">
  <button class="close" (click)="closeCartSidebar()">✕</button>
  <h3>Votre panier</h3>

  <ng-container *ngIf="cart?.items?.length; else emptyCart">
    <div class="cart-items">
      <div class="cart-item" *ngFor="let it of cart?.items">
        <div class="info">
          <div class="name">{{ it.product.name }}</div>
          <div class="meta">{{ it.product.price | currency:'DH':'symbol':'1.2-2' }} × {{ it.quantity }}</div>
        </div>
        <div class="quantity-controls">
          <button class="qty-btn" (click)="updateCartItemQuantity(it, it.quantity - 1)">-</button>
          <span class="qty-display">{{ it.quantity }}</span>
          <button class="qty-btn" (click)="updateCartItemQuantity(it, it.quantity + 1)">+</button>
          <button class="remove-btn" (click)="removeItemFromCart(it)">✕</button>
        </div>
        <div class="subtotal">{{ ((it.product.price||0) * (it.quantity||0)) | currency:'DH':'symbol':'1.2-2' }}</div>
      </div>
    </div>
    <div class="cart-footer">
      <div class="total"><span>Total:</span><strong>{{ cartTotal | currency:'DH':'symbol':'1.2-2' }}</strong></div>
      <a class="checkout-btn" routerLink="/checkout" (click)="closeCartSidebar()">Aller à la commande</a>
    </div>
  </ng-container>

  <ng-template #emptyCart>
    <p class="empty">Votre panier est vide.</p>
  </ng-template>
</aside>

<!-- Chat Assistant -->
<app-chat-assistant></app-chat-assistant>