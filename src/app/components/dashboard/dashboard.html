<div class="dashboard">
  <div class="dashboard-header">
    <h1>Tableau de bord - Gestion des produits</h1>
    <div class="header-actions">
      <button type="button" class="btn-primary" (click)="navigateToAddProduct()">
        <span class="icon">+</span>
        Ajouter un produit
      </button>
      <button type="button" class="btn-secondary" (click)="refreshProducts()">
        <span class="icon">‚Üª</span>
        Actualiser
      </button>
      <button type="button" class="btn-danger" (click)="logout()">
        <span class="icon">üö™</span>
        D√©connexion
      </button>
    </div>
  </div>


  <div class="dashboard-content">
    <div *ngIf="loading" class="status loading">
      <span class="spinner"></span>
      Chargement des produits...
    </div>

    <div *ngIf="error" class="status error">
      {{ error }}
      <button type="button" (click)="refreshProducts()" class="retry-btn">R√©essayer</button>
    </div>

    <div *ngIf="!loading && !error" class="products-section">
      <div class="section-header">
        <h2>Liste des produits ({{ filteredProducts.length }})</h2>
      </div>

      <div *ngIf="products.length === 0" class="empty-state">
        <div class="empty-icon">üì¶</div>
        <h3>Aucun produit trouv√©</h3>
        <p>Commencez par ajouter votre premier produit</p>
        <button type="button" class="btn-primary" (click)="navigateToAddProduct()">
          Ajouter un produit
        </button>
      </div>

      <!-- Barre de recherche visible lorsqu'il existe au moins un produit -->
      <div class="search-bar" *ngIf="products.length > 0">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Rechercher (nom, cat√©gorie, description)"
        />
      </div>

      <!-- Etat vide quand aucune correspondance avec la recherche -->
      <div *ngIf="products.length > 0 && filteredProducts.length === 0" class="empty-state">
        <div class="empty-icon">üîé</div>
        <h3>Aucune correspondance</h3>
        <p>Aucun produit ne correspond √† "{{ searchTerm }}".</p>
      </div>

      <div *ngIf="filteredProducts.length > 0" class="products-table">
        <table>
          <thead>
            <tr>
              <th>Image</th>
              <th>Nom</th>
              <th>Description</th>
              <th>Cat√©gorie</th>
              <th>Prix</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of filteredProducts" class="product-row">
              <td class="image-cell">
                <img [src]="product.image" [alt]="product.name" class="product-image" />
              </td>
              <td class="name-cell">
                <strong>{{ product.name }}</strong>
              </td>
              <td class="description-cell">
                <span class="description-text">{{ product.description }}</span>
              </td>
              <td class="category-cell">
                <span class="category-badge">{{ product.category }}</span>
              </td>
              <td class="price-cell">
                <span class="price">{{ product.price | currency:'DH':'symbol':'1.2-2' }}</span>
              </td>
              <td class="actions-cell">
                <div class="action-buttons">
                  <button type="button" class="btn-edit" (click)="editProduct(product.id)" title="Modifier">
                    ‚úèÔ∏è
                  </button>
                  <button type="button" class="btn-delete" (click)="deleteProduct(product)" title="Supprimer">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Product Modal -->
<div class="modal-overlay" *ngIf="showProductModal" (click)="closeProductModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="closeProductModal()">‚úï</button>
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Modifier le produit' : 'Ajouter un nouveau produit' }}</h2>
    </div>
    <div class="modal-body">
      <app-add-product 
        *ngIf="modalProduct"
        [product]="modalProduct" 
        [isEditMode]="isEditMode"
        (productSaved)="onProductSaved()"
        (cancelled)="closeProductModal()">
      </app-add-product>
    </div>
  </div>
</div>
