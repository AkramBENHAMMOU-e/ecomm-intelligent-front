<!-- Section Carrousel Produits Populaires -->
<section class="popular-carousel-section">
  <div class="carousel-container">
    <!-- Header avec titre accrocheur -->
    <div class="carousel-header">
      <h2 class="section-title">
        <span class="title-icon">üî•</span>
        Produits Stars
      </h2>
      <p class="section-subtitle">D√©couvrez nos best-sellers les plus demand√©s</p>
    </div>

    <!-- Carrousel principal -->
    <div class="carousel-wrapper" #carouselWrapper>
      <div class="carousel-track" [style.transform]="'translateX(' + currentOffset + 'px)'">
        <div class="carousel-item"
             *ngFor="let product of products; let i = index"
             [class.active]="i === currentIndex">
          <div class="product-card-carousel">
            <!-- Badge promotionnel -->
            <div class="promo-badge" *ngIf="product.discount && product.discount > 0">
              -{{ product.discount }}%
            </div>

            <!-- Image produit avec effet hover -->
            <div class="product-image-container">
              <img [src]="product.image"
                   [alt]="product.name"
                   class="product-image"
                   loading="lazy">
              <div class="image-overlay">
                <button class="quick-view-btn"
                        (click)="quickView(product)"
                        title="Vue rapide">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Informations produit -->
            <div class="product-info">
              <div class="product-category">{{ product.category }}</div>
              <h3 class="product-name">{{ product.name }}</h3>

              <!-- Prix avec remise -->
              <div class="product-pricing">
                <span class="current-price">{{ product.price | currency:'DH':'symbol':'1.0-0' }}</span>
                <span class="original-price" *ngIf="product.discount && product.discount > 0">
                  {{ (product.price * (1 + product.discount/100)) | currency:'DH':'symbol':'1.0-0' }}
                </span>
              </div>

              <!-- Rating √©toiles -->
              <div class="product-rating" *ngIf="getProductRating(product)">
                <div class="stars">
                  <span class="star" *ngFor="let star of [1,2,3,4,5]"
                        [class.filled]="star <= getProductRating(product)!">
                    ‚≠ê
                  </span>
                </div>
                <span class="rating-text">({{ getProductRating(product) }}/5)</span>
              </div>
            </div>

            <!-- Actions -->
            <div class="product-actions">
              <button class="btn-add-to-cart"
                      (click)="addToCart(product)"
                      [disabled]="addingToCart[product.id]">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="9" cy="21" r="1"></circle>
                  <circle cx="20" cy="21" r="1"></circle>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                {{ addingToCart[product.id] ? 'Ajout...' : 'Ajouter' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contr√¥les de navigation -->
    <div class="carousel-controls">
      <button class="carousel-btn prev-btn"
              (click)="previousSlide()"
              [disabled]="currentIndex === 0"
              aria-label="Produit pr√©c√©dent">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15,18 9,12 15,6"></polyline>
        </svg>
      </button>

      <div class="carousel-indicators">
        <button class="indicator"
                *ngFor="let product of products; let i = index"
                [class.active]="i === currentIndex"
                (click)="goToSlide(i)"
                [attr.aria-label]="'Aller au produit ' + (i + 1)">
        </button>
      </div>

      <button class="carousel-btn next-btn"
              (click)="nextSlide()"
              [disabled]="currentIndex >= products.length - itemsToShow"
              aria-label="Produit suivant">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9,18 15,12 9,6"></polyline>
        </svg>
      </button>
    </div>

    <!-- Voir tous les produits -->
    <div class="carousel-footer">
      <a routerLink="/products" class="view-all-btn">
        Voir tous les produits
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14"></path>
          <path d="M12 5l7 7-7 7"></path>
        </svg>
      </a>
    </div>
  </div>
</section>
