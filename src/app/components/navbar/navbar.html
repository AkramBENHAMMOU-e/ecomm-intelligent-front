<!-- Header Simple et Professionnel -->
<header class="header" *ngIf="showNavbar">
  <div class="header-content">
    <!-- Logo -->
    <a routerLink="/" class="logo">
      <span class="logo-icon">üõçÔ∏è</span>
      <span class="logo-text">E-Commerce Pro</span>
    </a>

    <!-- Navigation principale -->
    <nav class="nav">
      <a routerLink="/dashboard" *ngIf="isAdmin()" class="nav-link" routerLinkActive="active">Administration</a>
    </nav>

    <!-- Barre de recherche centr√©e -->
    <div class="search-container">
      <div class="search-bar">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="M21 21l-4.35-4.35"></path>
        </svg>
        <input
          type="text"
          class="search-input"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange($event)"
          placeholder="Rechercher un produit..."
        />
        <button class="search-clear" *ngIf="searchTerm" (click)="clearSearch()" title="Effacer la recherche">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>

    <!-- Actions utilisateur -->
    <div class="header-actions">
      <!-- Panier -->
      <button class="cart-icon" (click)="openCartSidebar()" title="Voir le panier">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="20" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
        <span class="cart-badge" *ngIf="cartItemsCount > 0">{{ cartItemsCount }}</span>
      </button>

      <!-- D√©connexion Admin -->
      <button class="btn-secondary btn-sm" (click)="logout()" *ngIf="isAdmin()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16,17 21,12 16,7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        D√©connexion
      </button>
    </div>
  </div>
</header>

<!-- Panier Sidebar Professionnel -->
<div class="cart-overlay" [class.show]="cartSidebarOpen" *ngIf="cartSidebarOpen" (click)="closeCartSidebar()"></div>
<aside class="cart-sidebar" [class.show]="cartSidebarOpen" *ngIf="cartSidebarOpen">
  <div class="cart-header">
    <h3>Votre panier</h3>
    <button class="cart-close" (click)="closeCartSidebar()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <div class="cart-body">
    <ng-container *ngIf="cart?.items?.length; else emptyCart">
      <div class="cart-items">
        <div class="cart-item" *ngFor="let it of cart?.items">
          <div class="cart-item-image">
            <img [src]="it.product.image" [alt]="it.product.name" appImageFallback />
          </div>
          <div class="cart-item-info">
            <div class="cart-item-name">{{ it.product.name }}</div>
            <div class="cart-item-price">{{ it.product.price | currency:'DH':'symbol':'1.2-2' }}</div>
          </div>
          <div class="cart-item-controls">
            <div class="quantity-controls">
              <button class="qty-btn" (click)="updateCartItemQuantity(it, it.quantity - 1)">-</button>
              <span class="qty-display">{{ it.quantity }}</span>
              <button class="qty-btn" (click)="updateCartItemQuantity(it, it.quantity + 1)">+</button>
            </div>
            <button class="remove-btn" (click)="removeItemFromCart(it)" title="Supprimer">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
              </svg>
            </button>
          </div>
          <div class="cart-item-subtotal">{{ ((it.product.price||0) * (it.quantity||0)) | currency:'DH':'symbol':'1.2-2' }}</div>
        </div>
      </div>
    </ng-container>

    <ng-template #emptyCart>
      <div class="empty-cart">
        <div class="empty-cart-icon">üõí</div>
        <h4>Votre panier est vide</h4>
        <p>D√©couvrez nos produits et commencez vos achats</p>
        <button class="btn-primary" routerLink="/" (click)="closeCartSidebar()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9,22 9,12 15,12 15,22"></polyline>
          </svg>
          Commencer votre achat
        </button>
      </div>
    </ng-template>
  </div>

  <div class="cart-footer" *ngIf="cart?.items?.length">
    <div class="cart-total">
      <div class="total-line">
        <span>Total</span>
        <strong>{{ cartTotal | currency:'DH':'symbol':'1.2-2' }}</strong>
      </div>
    </div>
    <button class="btn-primary btn-lg" routerLink="/checkout" (click)="closeCartSidebar()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 12l2 2 4-4"></path>
        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
        <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
        <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
      </svg>
      Passer la commande
    </button>
  </div>
</aside>